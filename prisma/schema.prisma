// Prisma 数据库模式定义

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
  // 连接池配置
  // connection_limit = 10
  // pool_timeout     = 20
}

// 用户模型
model User {
  id            Int       @id @default(autoincrement())
  uid           String    @unique @default(uuid()) @db.VarChar(36)
  username      String    @unique @db.VarChar(100)
  email         String    @unique @db.VarChar(255)
  password      String    @db.VarChar(255)
  role          String    @default("user") @db.VarChar(50)
  disabled      Boolean   @default(false)
  last_login_at DateTime?
  last_login_ip String?   @db.VarChar(45)
  created_at    DateTime  @default(now())
  updated_at    DateTime  @updatedAt

  files File[]

  @@map("users")
  @@index([uid])
  @@index([username])
  @@index([email])
}

// 文件模型（Synapse 上传记录）
model File {
  id               Int       @id @default(autoincrement())
  name             String    @db.VarChar(255)
  file_type        String    @db.VarChar(128)
  metadata         Json      @db.Json
  uploader_id      Int
  permission       String    @default("public") @db.VarChar(32)
  cost             Decimal   @db.Decimal(36, 18)
  project_name    String?   @db.VarChar(255)
  project_info     Json?     @db.Json
  synapse_index_id String    @db.VarChar(255)
  uploaded_at      DateTime  @default(now())
  deleted_at       DateTime?

  uploader User @relation(fields: [uploader_id], references: [id], onDelete: Restrict)

  @@map("files")
  @@index([uploader_id])
  @@index([synapse_index_id])
  @@index([deleted_at])
}
